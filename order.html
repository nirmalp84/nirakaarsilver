<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management - Nirakaar Silver</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lato', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-circle {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .logo-section h1 {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            margin: 0;
        }

        .logo-section p {
            font-size: 12px;
            opacity: 0.8;
            margin: 0;
        }

        .nav ul {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        .nav-item {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cart-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 25px;
            cursor: pointer;
            position: relative;
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f39c12;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        .main-content {
            margin-top: 100px;
            padding: 40px 0;
        }

        .order-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .tab-btn {
            flex: 1;
            padding: 20px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        /* Cart Styles */
        .cart-items {
            margin-bottom: 30px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .item-image {
            width: 80px;
            height: 80px;
            background: #ecf0f1;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #bdc3c7;
            margin-right: 20px;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .item-price {
            color: #e74c3c;
            font-weight: bold;
            font-size: 16px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-item {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 20px;
        }

        .cart-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-total {
            font-weight: bold;
            font-size: 18px;
            color: #2c3e50;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }

        /* Order Form */
        .order-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        /* Order Actions */
        .order-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn-primary,
        .btn-whatsapp,
        .btn-secondary {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366, #128c7e);
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-primary:hover,
        .btn-whatsapp:hover,
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        /* Order History */
        .order-history {
            margin-top: 30px;
        }

        .order-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-id {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            color: #2c3e50;
        }

        .order-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background: #f39c12;
            color: white;
        }

        .status-confirmed {
            background: #27ae60;
            color: white;
        }

        .status-shipped {
            background: #3498db;
            color: white;
        }

        .empty-cart {
            text-align: center;
            padding: 50px 20px;
            color: #7f8c8d;
        }

        .empty-cart i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #bdc3c7;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 120px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(300px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .notification.error {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .notification.info {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        /* Loading spinner for database operations */
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .order-form {
                grid-template-columns: 1fr;
            }

            .order-actions {
                flex-direction: column;
            }

            .cart-item {
                flex-direction: column;
                text-align: center;
            }

            .item-image {
                margin: 0 0 15px 0;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo-section">
                <div class="logo-circle">
                    <i class="fas fa-crown"></i>
                </div>
                <div>
                    <h1>Nirakaar Silver</h1>
                    <p>Premium Silver Craftsmanship</p>
                </div>
            </div>
            
            <nav class="nav">
                <ul>
                    <li><a href="index.html" class="nav-item">Home</a></li>
                    <li><a href="frames.html" class="nav-item">Silver Frames</a></li>
                    <li><a href="pots.html" class="nav-item">Silver Pots</a></li>
                    <li><a href="animals.html" class="nav-item">Silver Animals</a></li>
                    <li><a href="orders.html" class="nav-item active">Orders</a></li>
                </ul>
            </nav>
            
            <div class="header-actions">
                <button class="cart-btn" onclick="switchTab('cart')">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Order Management Tabs -->
            <div class="order-tabs">
                <button class="tab-btn active" onclick="switchTab('cart')">
                    <i class="fas fa-shopping-cart"></i>
                    Shopping Cart
                </button>
                <button class="tab-btn" onclick="switchTab('checkout')">
                    <i class="fas fa-credit-card"></i>
                    Checkout
                </button>
                <button class="tab-btn" onclick="switchTab('history')">
                    <i class="fas fa-history"></i>
                    Order History
                </button>
            </div>

            <!-- Cart Tab -->
            <div id="cart-tab" class="tab-content active">
                <h2>‡§Ü‡§™‡§ï‡§æ Shopping Cart</h2>
                <div id="cart-items-container">
                    <!-- Cart items will be populated here -->
                </div>
                
                <div id="cart-summary" style="display: none;">
                    <div class="cart-summary">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span id="subtotal">‚Çπ0</span>
                        </div>
                        <div class="summary-row">
                            <span>Delivery Charges:</span>
                            <span id="delivery-charges">‚Çπ100</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Total Amount:</span>
                            <span id="total-amount">‚Çπ0</span>
                        </div>
                    </div>
                    
                    <div class="order-actions">
                        <button class="btn-secondary" onclick="clearCart()">
                            <i class="fas fa-trash"></i>
                            Clear Cart
                        </button>
                        <button class="btn-primary" onclick="switchTab('checkout')">
                            <i class="fas fa-arrow-right"></i>
                            Proceed to Checkout
                        </button>
                    </div>
                </div>

                <div id="empty-cart" class="empty-cart">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>‡§Ü‡§™‡§ï‡§æ ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à</h3>
                    <p>‡§ï‡•Å‡§õ products add ‡§ï‡§∞‡•á‡§Ç shopping ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è</p>
                    <br>
                    <a href="frames.html" class="btn-primary">
                        <i class="fas fa-shopping-bag"></i>
                        Continue Shopping
                    </a>
                </div>
            </div>

            <!-- Checkout Tab -->
            <div id="checkout-tab" class="tab-content">
                <h2>Order Details ‡§≠‡§∞‡•á‡§Ç</h2>
                
                <form id="checkout-form" class="order-form">
                    <div class="form-group">
                        <label for="customer-name">‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ *</label>
                        <input type="text" id="customer-name" name="customerName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="customer-phone">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ *</label>
                        <input type="tel" id="customer-phone" name="customerPhone" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="customer-email">Email (Optional)</label>
                        <input type="email" id="customer-email" name="customerEmail">
                    </div>
                    
                    <div class="form-group">
                        <label for="delivery-type">Delivery Type *</label>
                        <select id="delivery-type" name="deliveryType" required onchange="updateDeliveryCharges()">
                            <option value="">Select Delivery Type</option>
                            <option value="home">Home Delivery</option>
                            <option value="pickup">Store Pickup</option>
                        </select>
                    </div>
                    
                    <div class="form-group full-width" id="address-group">
                        <label for="customer-address">‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ *</label>
                        <textarea id="customer-address" name="customerAddress" placeholder="House No., Street, Area, City, State, Pincode" required></textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="order-notes">Special Instructions (Optional)</label>
                        <textarea id="order-notes" name="orderNotes" placeholder="Any special requests or notes..."></textarea>
                    </div>
                </form>

                <div class="cart-summary">
                    <h3>Order Summary</h3>
                    <div id="checkout-summary">
                        <!-- Order summary will be populated here -->
                    </div>
                </div>

                <div class="order-actions">
                    <button class="btn-secondary" onclick="switchTab('cart')">
                        <i class="fas fa-arrow-left"></i>
                        Back to Cart
                    </button>
                    <button class="btn-whatsapp" onclick="placeOrderWhatsApp()">
                        <i class="fab fa-whatsapp"></i>
                        Order via WhatsApp
                    </button>
                    <button class="btn-primary" onclick="placeOrder()" id="place-order-btn">
                        <i class="fas fa-check"></i>
                        <span class="loading-spinner" id="order-spinner"></span>
                        Confirm Order
                    </button>
                </div>
            </div>

            <!-- Order History Tab -->
            <div id="history-tab" class="tab-content">
                <h2>‡§Ü‡§™‡§ï‡•á Previous Orders</h2>
                <div id="order-history-container">
                    <!-- Order history will be populated here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Supabase JS SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/supabase-js/2.38.0/umd/supabase.min.js"></script>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://dsxrxzaelgghjiycxilm.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzeHJ4emFlbGdnaGppeWN4aWxtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyMDY0NTIsImV4cCI6MjA2OTc4MjQ1Mn0.vWTtSSI3gbAP6OiM4ftzUq61jW6uuPSwa7O6uz8Buq4';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Global variables
        let cart = JSON.parse(localStorage.getItem('nirankaar_cart') || '[]');
        let orders = JSON.parse(localStorage.getItem('nirankaar_orders') || '[]');

        // Product database (can be expanded)
        const productDatabase = {
            // Frames
            101: { id: 101, name: '‡§™‡§æ‡§∞‡§Ç‡§™‡§∞‡§ø‡§ï ‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§´‡•ç‡§∞‡•á‡§Æ', price: 2500, category: 'frames' },
            102: { id: 102, name: '‡§Æ‡•â‡§°‡§∞‡•ç‡§® ‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§´‡•ç‡§∞‡•á‡§Æ', price: 3200, category: 'frames' },
            103: { id: 103, name: '‡§°‡•á‡§ï‡•ã‡§∞‡•á‡§ü‡§ø‡§µ ‡§Æ‡§ø‡§®‡•Ä ‡§´‡•ç‡§∞‡•á‡§Æ', price: 1800, category: 'frames' },
            104: { id: 104, name: '‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§≤‡§æ‡§∞‡•ç‡§ú ‡§´‡•ç‡§∞‡•á‡§Æ', price: 4500, category: 'frames' },
            105: { id: 105, name: '‡§è‡§≤‡§ø‡§ó‡•á‡§Ç‡§ü ‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§´‡•ç‡§∞‡•á‡§Æ', price: 2800, category: 'frames' },
            106: { id: 106, name: '‡§∞‡•â‡§Ø‡§≤ ‡§°‡•á‡§ï‡•ã‡§∞‡•á‡§ü‡§ø‡§µ ‡§´‡•ç‡§∞‡•á‡§Æ', price: 3800, category: 'frames' },
            
            // Pots
            201: { id: 201, name: '‡§™‡§æ‡§∞‡§Ç‡§™‡§∞‡§ø‡§ï ‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§™‡•â‡§ü', price: 3500, category: 'pots' },
            202: { id: 202, name: '‡§Æ‡•â‡§°‡§∞‡•ç‡§® ‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§™‡•â‡§ü', price: 4200, category: 'pots' },
            203: { id: 203, name: '‡§°‡•á‡§ï‡•ã‡§∞‡•á‡§ü‡§ø‡§µ ‡§Æ‡§ø‡§®‡•Ä ‡§™‡•â‡§ü', price: 2800, category: 'pots' },
            204: { id: 204, name: '‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§≤‡§æ‡§∞‡•ç‡§ú ‡§™‡•â‡§ü', price: 5500, category: 'pots' },
            205: { id: 205, name: '‡§è‡§≤‡§ø‡§ó‡•á‡§Ç‡§ü ‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§™‡•â‡§ü', price: 3800, category: 'pots' },
            206: { id: 206, name: '‡§∞‡•â‡§Ø‡§≤ ‡§°‡•á‡§ï‡•ã‡§∞‡•á‡§ü‡§ø‡§µ ‡§™‡•â‡§ü', price: 4800, category: 'pots' },
            
            // Animals
            301: { id: 301, name: '‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§π‡§æ‡§•‡•Ä', price: 5500, category: 'animals' },
            302: { id: 302, name: '‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§Æ‡•ã‡§∞', price: 4800, category: 'animals' },
            303: { id: 303, name: '‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§ò‡•ã‡§°‡§º‡§æ', price: 6200, category: 'animals' },
            304: { id: 304, name: '‡§Æ‡§ø‡§®‡•Ä ‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§π‡§æ‡§•‡•Ä', price: 3800, category: 'animals' },
            305: { id: 305, name: '‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§∂‡•á‡§∞', price: 7500, category: 'animals' },
            306: { id: 306, name: '‡§°‡§æ‡§Ç‡§∏‡§ø‡§Ç‡§ó ‡§∏‡§ø‡§≤‡•ç‡§µ‡§∞ ‡§Æ‡•ã‡§∞', price: 4200, category: 'animals' }
        };

        // Utility Functions
        function saveCart() {
            localStorage.setItem('nirankaar_cart', JSON.stringify(cart));
            updateCartCount();
        }

        function saveOrders() {
            localStorage.setItem('nirankaar_orders', JSON.stringify(orders));
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.querySelector('.cart-count').textContent = totalItems;
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type} show`;
            
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'error' ? 'exclamation-circle' : 'info-circle';
            
            notification.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Loading state management
        function setLoadingState(isLoading) {
            const button = document.getElementById('place-order-btn');
            const spinner = document.getElementById('order-spinner');
            
            if (isLoading) {
                button.disabled = true;
                spinner.style.display = 'inline-block';
                button.innerHTML = `
                    <i class="fas fa-check"></i>
                    <span class="loading-spinner" style="display: inline-block;"></span>
                    Processing...
                `;
            } else {
                button.disabled = false;
                spinner.style.display = 'none';
                button.innerHTML = `
                    <i class="fas fa-check"></i>
                    Confirm Order
                `;
            }
        }

        // Database Functions
        async function saveOrderToDatabase(orderData) {
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .insert([{
                        products: orderData.items,
                        total_price: orderData.total,
                        customer_name: orderData.customerName,
                        customer_phone: orderData.customerPhone,
                        address: orderData.deliveryType === 'home' ? orderData.customerAddress : 'Store Pickup',
                        status: 'pending'
                    }])
                    .select()
                    .single();

                if (error) {
                    console.error('Database Error:', error);
                    throw error;
                }

                return data;
            } catch (error) {
                console.error('Error saving order to database:', error);
                throw error;
            }
        }

        async function loadOrdersFromDatabase() {
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('Database Error:', error);
                    return [];
                }

                return data || [];
            } catch (error) {
                console.error('Error loading orders from database:', error);
                return [];
            }
        }

        // Tab Management
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Add active class to selected button
            event.target.classList.add('active');
            
            // Load content based on tab
            if (tabName === 'cart') {
                loadCartItems();
            } else if (tabName === 'checkout') {
                loadCheckoutSummary();
            } else if (tabName === 'history') {
                loadOrderHistory();
            }
        }

        // Cart Functions
        function addToCart(productId, productName, productPrice) {
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: productPrice,
                    quantity: 1
                });
            }
            
            saveCart();
            showNotification('‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!');
            loadCartItems();
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveCart();
            loadCartItems();
            showNotification('‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§∏‡•á ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'info');
        }

        function updateQuantity(productId, newQuantity) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                if (newQuantity <= 0) {
                    removeFromCart(productId);
                } else {
                    item.quantity = newQuantity;
                    saveCart();
                    loadCartItems();
                }
            }
        }

        function clearCart() {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§Ö‡§™‡§®‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                cart = [];
                saveCart();
                loadCartItems();
                showNotification('‡§ï‡§æ‡§∞‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'info');
            }
        }

        function loadCartItems() {
            const container = document.getElementById('cart-items-container');
            const summaryDiv = document.getElementById('cart-summary');
            const emptyCartDiv = document.getElementById('empty-cart');
            
            if (cart.length === 0) {
                container.innerHTML = '';
                summaryDiv.style.display = 'none';
                emptyCartDiv.style.display = 'block';
                return;
            }
            
            emptyCartDiv.style.display = 'none';
            summaryDiv.style.display = 'block';
            
            let html = '<div class="cart-items">';
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                html += `
                    <div class="cart-item">
                        <div class="item-image">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">‚Çπ${item.price.toLocaleString()}</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
                                <span style="padding: 0 15px; font-weight: bold;">${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; font-size: 18px; color: #e74c3c;">‚Çπ${itemTotal.toLocaleString()}</div>
                            <button class="remove-item" onclick="removeFromCart(${item.id})">
                                <i class="fas fa-trash"></i> Remove
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            // Update summary
            const deliveryCharges = subtotal >= 1000 ? 0 : 100;
            const total = subtotal + deliveryCharges;
            
            document.getElementById('subtotal').textContent = `‚Çπ${subtotal.toLocaleString()}`;
            document.getElementById('delivery-charges').textContent = subtotal >= 1000 ? 'FREE' : `‚Çπ${deliveryCharges}`;
            document.getElementById('total-amount').textContent = `‚Çπ${total.toLocaleString()}`;
        }

        // Checkout Functions
        function loadCheckoutSummary() {
            if (cart.length === 0) {
                switchTab('cart');
                showNotification('‡§™‡§π‡§≤‡•á ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç', 'error');
                return;
            }
            
            const container = document.getElementById('checkout-summary');
            let html = '';
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                html += `
                    <div class="summary-row">
                        <span>${item.name} (x${item.quantity})</span>
                        <span>‚Çπ${itemTotal.toLocaleString()}</span>
                    </div>
                `;
            });
            
            const deliveryCharges = subtotal >= 1000 ? 0 : 100;
            const total = subtotal + deliveryCharges;
            
            html += `
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span>‚Çπ${subtotal.toLocaleString()}</span>
                </div>
                <div class="summary-row">
                    <span>Delivery:</span>
                    <span>${subtotal >= 1000 ? 'FREE' : '‚Çπ' + deliveryCharges}</span>
                </div>
                <div class="summary-row summary-total">
                    <span>Total Amount:</span>
                    <span>‚Çπ${total.toLocaleString()}</span>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function updateDeliveryCharges() {
            const deliveryType = document.getElementById('delivery-type').value;
            const addressGroup = document.getElementById('address-group');
            
            if (deliveryType === 'pickup') {
                addressGroup.style.display = 'none';
                document.getElementById('customer-address').required = false;
            } else {
                addressGroup.style.display = 'block';
                document.getElementById('customer-address').required = true;
            }
            
            loadCheckoutSummary();
        }

        function placeOrderWhatsApp() {
            const form = document.getElementById('checkout-form');
            const formData = new FormData(form);
            
            // Validate required fields
            if (!formData.get('customerName') || !formData.get('customerPhone') || !formData.get('deliveryType')) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }
            
            if (formData.get('deliveryType') === 'home' && !formData.get('customerAddress')) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }
            
            // Generate WhatsApp message
            let message = `üõçÔ∏è *‡§®‡§Ø‡§æ ‡§ë‡§∞‡•ç‡§°‡§∞ - Nirakaar Silver*\n\n`;
            message += `üë§ *‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä:*\n`;
            message += `‡§®‡§æ‡§Æ: ${formData.get('customerName')}\n`;
            message += `‡§´‡•ã‡§®: ${formData.get('customerPhone')}\n`;
            
            if (formData.get('customerEmail')) {
                message += `Email: ${formData.get('customerEmail')}\n`;
            }
            
            message += `\nüì¶ *‡§ë‡§∞‡•ç‡§°‡§∞ ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏:*\n`;
            
            let subtotal = 0;
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                message += `‚Ä¢ ${item.name}\n  ‚Çπ${item.price.toLocaleString()} x ${item.quantity} = ‚Çπ${itemTotal.toLocaleString()}\n\n`;
            });
            
            const deliveryCharges = subtotal >= 1000 ? 0 : 100;
            const total = subtotal + deliveryCharges;
            
            message += `üí∞ *‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏:*\n`;
            message += `Subtotal: ‚Çπ${subtotal.toLocaleString()}\n`;
            message += `Delivery: ${subtotal >= 1000 ? 'FREE' : '‚Çπ' + deliveryCharges}\n`;
            message += `*‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${total.toLocaleString()}*\n\n`;
            
            message += `üöö *‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä:*\n`;
            if (formData.get('deliveryType') === 'home') {
                message += `Type: Home Delivery\n`;
                message += `‡§™‡§§‡§æ: ${formData.get('customerAddress')}\n`;
            } else {
                message += `Type: Store Pickup\n`;
            }
            
            if (formData.get('orderNotes')) {
                message += `\nüìù *Special Instructions:*\n${formData.get('orderNotes')}\n`;
            }
            
            message += `\nüôè ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç!`;
            
            const phoneNumber = "9001048718"; // Replace with your WhatsApp number
            const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappURL, '_blank');
            showNotification('WhatsApp ‡§™‡§∞ ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ!', 'success');
        }

        async function placeOrder() {
            const form = document.getElementById('checkout-form');
            const formData = new FormData(form);
            
            // Validate required fields
            if (!formData.get('customerName') || !formData.get('customerPhone') || !formData.get('deliveryType')) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }
            
            if (formData.get('deliveryType') === 'home' && !formData.get('customerAddress')) {
                showNotification('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§™‡§§‡§æ ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }

            // Set loading state
            setLoadingState(true);
            
            try {
                // Generate order ID
                const orderId = 'NS' + Date.now();
                
                // Calculate totals
                let subtotal = 0;
                cart.forEach(item => {
                    subtotal += item.price * item.quantity;
                });
                
                const deliveryCharges = subtotal >= 1000 ? 0 : 100;
                const total = subtotal + deliveryCharges;
                
                // Create order object
                const orderData = {
                    id: orderId,
                    date: new Date().toISOString(),
                    customerName: formData.get('customerName'),
                    customerPhone: formData.get('customerPhone'),
                    customerEmail: formData.get('customerEmail') || '',
                    deliveryType: formData.get('deliveryType'),
                    customerAddress: formData.get('customerAddress') || '',
                    orderNotes: formData.get('orderNotes') || '',
                    items: [...cart],
                    subtotal: subtotal,
                    deliveryCharges: deliveryCharges,
                    total: total,
                    status: 'pending'
                };
                
                // Save to Supabase database
                const savedOrder = await saveOrderToDatabase(orderData);
                
                // Also save to local storage as backup
                orders.unshift(orderData);
                saveOrders();
                
                // Clear cart
                cart = [];
                saveCart();
                
                // Show success message with database order ID
                const dbOrderId = savedOrder.id;
                showNotification(`‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∏‡§´‡§≤‡§§‡§Æ‡•ç‡§§‡§ø ‡§∏‡•á ‡§™‡•ç‡§≤‡•á‡§∏ ‡§π‡•ã ‡§ó‡§Ø‡§æ! Order ID: #${dbOrderId}`, 'success');
                
                // Reset form
                form.reset();
                
                // Switch to order history
                setTimeout(() => {
                    switchTab('history');
                }, 1500);
                
            } catch (error) {
                console.error('Order placement error:', error);
                showNotification('‡§ë‡§∞‡•ç‡§°‡§∞ ‡§™‡•ç‡§≤‡•á‡§∏ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•á‡§Ç‡•§', 'error');
            } finally {
                // Remove loading state
                setLoadingState(false);
            }
        }

        // Order History Functions
        async function loadOrderHistory() {
            const container = document.getElementById('order-history-container');
            
            try {
                // Load orders from database
                const dbOrders = await loadOrdersFromDatabase();
                
                // Merge with local orders (for compatibility)
                const allOrders = [...dbOrders, ...orders];
                
                // Remove duplicates based on ID
                const uniqueOrders = allOrders.filter((order, index, self) => 
                    index === self.findIndex(o => o.id === order.id)
                );
                
                if (uniqueOrders.length === 0) {
                    container.innerHTML = `
                        <div class="empty-cart">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>‡§ï‡•ã‡§à ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</h3>
                            <p>‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§Ü‡§™‡§®‡•á ‡§ï‡•ã‡§à ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                uniqueOrders.forEach(order => {
                    // Handle both database and local order formats
                    const orderDate = order.created_at ? 
                        new Date(order.created_at).toLocaleDateString('hi-IN') :
                        new Date(order.date).toLocaleDateString('hi-IN');
                    
                    const orderId = order.id;
                    const customerName = order.customer_name || order.customerName;
                    const customerPhone = order.customer_phone || order.customerPhone;
                    const totalAmount = order.total_price || order.total;
                    const orderItems = order.products || order.items;
                    const deliveryAddress = order.address || order.customerAddress;
                    
                    html += `
                        <div class="order-card">
                            <div class="order-header">
                                <div class="order-id">Order #${orderId}</div>
                                <div class="order-status status-${order.status}">
                                    ${order.status === 'pending' ? 'Pending' : 
                                      order.status === 'confirmed' ? 'Confirmed' : 
                                      order.status === 'shipped' ? 'Shipped' : 'Delivered'}
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <strong>Date:</strong> ${orderDate} | 
                                <strong>Total:</strong> ‚Çπ${totalAmount.toLocaleString()} | 
                                <strong>Items:</strong> ${orderItems.length}
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <strong>Customer:</strong> ${customerName} (${customerPhone})
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <strong>Delivery:</strong> ${deliveryAddress === 'Store Pickup' ? 'Store Pickup' : 'Home Delivery'}
                                ${deliveryAddress && deliveryAddress !== 'Store Pickup' ? `<br><small>${deliveryAddress}</small>` : ''}
                            </div>
                            
                            <details>
                                <summary style="cursor: pointer; font-weight: bold;">View Items</summary>
                                <div style="margin-top: 10px;">
                    `;
                    
                    orderItems.forEach(item => {
                        const itemPrice = item.price;
                        const itemQuantity = item.quantity;
                        const itemName = item.name;
                        
                        html += `
                            <div style="padding: 5px 0; border-bottom: 1px solid #eee;">
                                ${itemName} - ‚Çπ${itemPrice.toLocaleString()} x ${itemQuantity} = ‚Çπ${(itemPrice * itemQuantity).toLocaleString()}
                            </div>
                        `;
                    });
                    
                    html += `
                                </div>
                            </details>
                            
                            <div style="margin-top: 15px;">
                                <button class="btn-whatsapp" onclick="reorderWhatsApp('${orderId}')">
                                    <i class="fab fa-whatsapp"></i>
                                    Reorder via WhatsApp
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading order history:', error);
                showNotification('‡§ë‡§∞‡•ç‡§°‡§∞ ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•Å‡§à', 'error');
                
                // Fallback to local orders
                const localOrders = orders;
                if (localOrders.length === 0) {
                    container.innerHTML = `
                        <div class="empty-cart">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>‡§ï‡•ã‡§à ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</h3>
                            <p>‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§Ü‡§™‡§®‡•á ‡§ï‡•ã‡§à ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à</p>
                        </div>
                    `;
                } else {
                    // Show local orders as fallback
                    loadLocalOrderHistory();
                }
            }
        }

        function loadLocalOrderHistory() {
            const container = document.getElementById('order-history-container');
            let html = '';
            
            orders.forEach(order => {
                const orderDate = new Date(order.date).toLocaleDateString('hi-IN');
                
                html += `
                    <div class="order-card">
                        <div class="order-header">
                            <div class="order-id">Order #${order.id}</div>
                            <div class="order-status status-${order.status}">
                                ${order.status === 'pending' ? 'Pending' : 
                                  order.status === 'confirmed' ? 'Confirmed' : 
                                  order.status === 'shipped' ? 'Shipped' : 'Delivered'}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>Date:</strong> ${orderDate} | 
                            <strong>Total:</strong> ‚Çπ${order.total.toLocaleString()} | 
                            <strong>Items:</strong> ${order.items.length}
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>Customer:</strong> ${order.customerName} (${order.customerPhone})
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong>Delivery:</strong> ${order.deliveryType === 'home' ? 'Home Delivery' : 'Store Pickup'}
                            ${order.customerAddress ? `<br><small>${order.customerAddress}</small>` : ''}
                        </div>
                        
                        <details>
                            <summary style="cursor: pointer; font-weight: bold;">View Items</summary>
                            <div style="margin-top: 10px;">
                `;
                
                order.items.forEach(item => {
                    html += `
                        <div style="padding: 5px 0; border-bottom: 1px solid #eee;">
                            ${item.name} - ‚Çπ${item.price.toLocaleString()} x ${item.quantity} = ‚Çπ${(item.price * item.quantity).toLocaleString()}
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </details>
                        
                        <div style="margin-top: 15px;">
                            <button class="btn-whatsapp" onclick="reorderWhatsApp('${order.id}')">
                                <i class="fab fa-whatsapp"></i>
                                Reorder via WhatsApp
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function reorderWhatsApp(orderId) {
            // Try to find order in both database and local storage
            let order = orders.find(o => o.id === orderId);
            
            if (!order) {
                showNotification('‡§ë‡§∞‡•ç‡§°‡§∞ ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á', 'error');
                return;
            }
            
            let message = `üîÑ *Reorder Request - Nirakaar Silver*\n\n`;
            message += `Original Order: #${orderId}\n`;
            message += `Customer: ${order.customerName || order.customer_name}\n`;
            message += `Phone: ${order.customerPhone || order.customer_phone}\n\n`;
            
            message += `üì¶ *Items to Reorder:*\n`;
            const orderItems = order.items || order.products;
            orderItems.forEach(item => {
                message += `‚Ä¢ ${item.name} - ‚Çπ${item.price.toLocaleString()} x ${item.quantity}\n`;
            });
            
            const totalAmount = order.total || order.total_price;
            message += `\nüí∞ *Previous Total: ‚Çπ${totalAmount.toLocaleString()}*\n\n`;
            message += `‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§∏‡•Ä order ‡§ï‡•ã ‡§´‡§ø‡§∞ ‡§∏‡•á confirm ‡§ï‡§∞‡•á‡§Ç! üôè`;
            
            const phoneNumber = "9001048718"; // Replace with your WhatsApp number
            const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappURL, '_blank');
            showNotification('Reorder request ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ!', 'success');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            loadCartItems();
            
            // Check if redirected from a product page with cart items
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('tab')) {
                switchTab(urlParams.get('tab'));
            }
            
            // Test database connection
            testDatabaseConnection();
        });

        // Test database connection
        async function testDatabaseConnection() {
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .select('count', { count: 'exact', head: true });
                
                if (error) {
                    console.warn('Database connection test failed:', error);
                } else {
                    console.log('Database connected successfully');
                }
            } catch (error) {
                console.warn('Database connection test failed:', error);
            }
        }

        // Expose functions globally for product pages
        window.addToCartGlobal = addToCart;
        window.showCartModal = function() {
            window.location.href = 'orders.html?tab=cart';
        };
    </script>
</body>
</html>